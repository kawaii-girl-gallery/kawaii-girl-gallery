{% extends "admin/base.html" %}
{% block branding %}
<style>
    /* 1. モーダル・基本設定（維持） */
    .modal-content {
        position: fixed !important;
        top: 45% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        height: 70vh !important;
        max-width: 85vw !important;
        border: 3px solid #fff !important;
        border-radius: 0 !important;
        z-index: 20001 !important;
        margin: 0 !important;
        display: block !important;
    }

    #modal-counter, .modal-counter {
        position: fixed !important;
        top: calc(45% - (70vh / 2)) !important;
        left: 50% !important;
        transform: translate(-50%, -100%) !important;
        background: rgba(0,0,0,0.8) !important;
        padding: 5px 20px !important;
        border: 2px solid #fff !important;
        border-bottom: none !important;
        border-radius: 10px 10px 0 0 !important;
        z-index: 20010 !important;
    }

    #modal-cart-btn, .modal-cart-action, [onclick*="cart"], button[style*="top: 0"] {
        position: fixed !important;
        top: calc(45% + (70vh / 2)) !important;
        left: 50% !important;
        transform: translate(-50%, 0) !important;
        width: calc(85vw + 6px) !important;
        background: #28a745 !important;
        color: white !important;
        padding: 15px 0 !important;
        font-size: 18px !important;
        font-weight: 900 !important;
        border: 3px solid #fff !important;
        border-top: none !important;
        border-radius: 0 0 15px 15px !important;
        cursor: pointer !important;
        text-align: center !important;
        z-index: 20015 !important;
    }

    /* 2. サイドメニュー配色（維持） */
    #nav-sidebar .app-catalog_a4 caption { background: #ff4d94 !important; }
    #nav-sidebar .app-catalog_tcg caption { background: #2684ff !important; }
    #nav-sidebar .app-catalog_admin_custom caption { background: #f0ad4e !important; }

    /* 3. ナビゲーション（維持） */
    .modal-nav { position: fixed !important; top: 50% !important; transform: translateY(-50%) !important; font-size: 80px !important; color: rgba(255,255,255,0.4) !important; z-index: 20020 !important; }
    .close-btn { position: fixed !important; top: 20px !important; right: 40px !important; z-index: 20030 !important; }

    /* 4. スマホ用：重ならない縦積みカードレイアウト */
    @media (max-width: 768px) {
        /* テーブル構造を解除してカード化 */
        .results, .results table, .results tbody, .results tr {
            display: block !important;
            width: 100% !important;
        }
        .results thead { display: none !important; }

        .results tr {
            display: flex !important;
            flex-direction: column !important; /* 上から下へ順番に並べる */
            align-items: center !important;
            margin-bottom: 35px !important;
            padding: 20px 15px !important;
            background: #1a1a1a !important;
            border: 1px solid #444 !important;
            border-radius: 15px !important;
            position: relative !important;
        }

        /* ① 金額：一番上 */
        .field-price, .field-product_price, td:nth-child(4) {
            display: block !important; order: 1 !important;
            color: #ffcc00 !important; font-size: 22px !important; font-weight: bold !important;
            margin-bottom: 15px !important; border: none !important; text-align: center !important;
        }

        /* ② 画像：二番目 */
        .field-image, .field-product_image, td:has(img), [class*="image"] {
            display: block !important; order: 2 !important;
            margin-bottom: 15px !important; border: none !important; text-align: center !important;
        }
        .results img { max-width: 200px !important; height: auto !important; border: 2px solid #fff !important; display: block !important; margin: 0 auto !important; }

        /* ③ 商品名：三番目 */
        .field-name, .field-product_name, td:nth-child(2) {
            display: block !important; order: 3 !important;
            color: #fff !important; font-size: 16px !important; text-align: center !important;
            margin-bottom: 15px !important; border: none !important; line-height: 1.4 !important;
        }

        /* ④ タイマー：四番目 */
        td[class*="timer"], td[class*="time"], .field-timer_display, td:nth-child(5) {
            display: block !important; order: 4 !important;
            color: #00ffcc !important; font-weight: bold !important;
            padding: 8px 20px !important; border: 1px solid #00ffcc !important; border-radius: 20px !important;
            text-align: center !important;
        }

        /* ⑤ チェックボックス：左上に固定 */
        .action-checkbox, .action-checkbox-column, td:nth-child(1) {
            position: absolute !important; left: 15px !important; top: 15px !important;
            display: block !important; width: 40px !important; height: 40px !important;
            z-index: 10 !important; transform: scale(1.6) !important; border: none !important;
        }

        /* 不要なセルを隠す */
        .results td:empty, .results td:not([display="block"]) { border: none !important; }
    }
</style>

<script>
    /* 商品名の整形（「同人」でカットし、空白で改行） */
    function formatMobileNames() {
        const names = document.querySelectorAll('.field-name, .field-product_name, td:nth-child(2)');
        names.forEach(cell => {
            if (cell.getAttribute('data-done')) return;
            let text = cell.innerText.split("同人")[0].trim();
            // 改行を入れて縦に並べる
            cell.innerHTML = `<strong>${text.replace(/[\s　]+/g, '</strong><br><span style="color:#aaa;font-size:13px;">')}</span>`;
            cell.setAttribute('data-done', 'true');
        });
    }
    document.addEventListener("DOMContentLoaded", formatMobileNames);
    window.addEventListener("load", formatMobileNames);
    setInterval(formatMobileNames, 2000);
</script>

<h1 id="site-name"><a href="{% url 'admin:index' %}">kawaii女の子図鑑</a></h1>
{% endblock %}
