{% extends "admin/base.html" %}
{% block branding %}
<style>
    /* 1. モーダル・基本設定（維持） */
    .modal-content { position: fixed !important; top: 45% !important; left: 50% !important; transform: translate(-50%, -50%) !important; height: 70vh !important; max-width: 85vw !important; border: 3px solid #fff !important; z-index: 20001 !important; display: block !important; }
    #modal-cart-btn { position: fixed !important; top: calc(45% + (70vh / 2)) !important; left: 50% !important; transform: translate(-50%, 0) !important; width: calc(85vw + 6px) !important; background: #28a745 !important; color: white !important; padding: 15px 0 !important; font-size: 18px !important; font-weight: 900 !important; border: 3px solid #fff !important; z-index: 20015 !important; }

    /* 2. スマホ用：画像・CB・タイマー・名前の配置 */
    @media (max-width: 768px) {
        .results, .results table, .results tbody, .results tr {
            display: block !important;
            width: 100% !important;
        }
        .results thead { display: none !important; }

        .results tr {
            position: relative !important;
            display: block !important;
            padding: 45px 60px 80px 60px !important; /* 上:金額、左右:CB/タイマー、下:名前の余白 */
            border-bottom: 2px solid #444 !important;
            background: #1a1a1a !important;
            min-height: 150px !important;
        }

        /* ① 画像名の上に金額 (最上部) */
        .mobile-price-label {
            position: absolute !important; top: 10px !important; left: 0 !important; width: 100% !important;
            text-align: center !important; color: #ffcc00 !important; font-weight: bold !important; font-size: 18px !important;
        }

        /* ② 画像の左にチェックボックス */
        .action-checkbox, .action-checkbox-column {
            position: absolute !important; left: 10px !important; top: 50% !important;
            transform: translateY(-50%) !important; display: block !important; width: 40px !important;
        }

        /* ③ 画像 (中央) */
        .field-image, .field-product_image, [class*="image"] {
            display: flex !important; justify-content: center !important; align-items: center !important;
            width: 100% !important; height: auto !important;
        }
        .results img { max-width: 160px !important; height: auto !important; border: 2px solid #fff !important; display: block !important; }

        /* ④ 画像の右にタイマー */
        td[class*="timer"], td[class*="time"], .field-timer_display {
            position: absolute !important; right: 5px !important; top: 50% !important;
            transform: translateY(-50%) !important; display: block !important;
            width: 50px !important; color: #00ffcc !important; font-weight: bold !important; font-size: 12px !important; text-align: center !important;
        }

        /* ⑤ 画像の下に商品名 (下部) */
        .mobile-name-label {
            position: absolute !important; bottom: 10px !important; left: 0 !important; width: 100% !important;
            text-align: center !important; color: #fff !important; padding: 0 10px !important;
        }

        /* 元のテキストを隠す */
        .results td:not(.action-checkbox):not([class*="image"]):not([class*="timer"]):not([class*="time"]):not(.field-timer_display) {
            display: none !important;
        }
    }
</style>

<script>
    function layoutRefresh() {
        const rows = document.querySelectorAll('#result_list tbody tr');
        rows.forEach(row => {
            if (row.querySelector('.mobile-name-label')) return;

            // 価格(金額)を最上部に設置
            const priceCell = row.querySelector('.field-price, .field-product_price');
            const priceDiv = document.createElement('div');
            priceDiv.className = 'mobile-price-label';
            priceDiv.innerText = priceCell ? priceCell.innerText : "";
            row.appendChild(priceDiv);

            // 商品名を最下部に2行で設置
            const nameCell = row.querySelector('.field-name, .field-product_name, td:nth-child(2)');
            if (nameCell) {
                let clean = nameCell.innerText.split("同人")[0].trim();
                let sp = clean.split(/[\s　]+/);
                const nameDiv = document.createElement('div');
                nameDiv.className = 'mobile-name-label';
                nameDiv.innerHTML = `<strong>${sp[0] || ""}</strong><br><span style="font-size:12px;color:#ccc;">${sp.slice(1).join(" ")}</span>`;
                row.appendChild(nameDiv);
            }
        });
    }
    document.addEventListener("DOMContentLoaded", layoutRefresh);
    window.addEventListener("load", layoutRefresh);
    setInterval(layoutRefresh, 1000);
</script>

<h1 id="site-name"><a href="{% url 'admin:index' %}">kawaii女の子図鑑</a></h1>
{% endblock %}
