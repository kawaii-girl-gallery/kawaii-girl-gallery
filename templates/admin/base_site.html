{% extends "admin/base.html" %}
{% block branding %}
<style>
    /* 1〜3. 基本設定（維持） */
    .modal-content { position: fixed !important; top: 45% !important; left: 50% !important; transform: translate(-50%, -50%) !important; height: 70vh !important; max-width: 85vw !important; border: 3px solid #fff !important; z-index: 20001 !important; display: block !important; }
    #modal-cart-btn { position: fixed !important; top: calc(45% + (70vh / 2)) !important; left: 50% !important; transform: translate(-50%, 0) !important; width: calc(85vw + 6px) !important; background: #28a745 !important; color: white !important; padding: 15px 0 !important; font-size: 18px !important; font-weight: 900 !important; border: 3px solid #fff !important; z-index: 20015 !important; }
    #nav-sidebar .app-catalog_a4 caption { background: #ff4d94 !important; }
    #nav-sidebar .app-catalog_tcg caption { background: #2684ff !important; }

    /* 4. スマホ表示の調整 */
    @media (max-width: 768px) {
        .results, .results table, .results tbody, .results tr {
            display: table !important;
            width: 100% !important;
        }
        .action-checkbox, .action-checkbox-column, #result_list td:first-child {
            display: table-cell !important;
            width: 45px !important;
            visibility: visible !important;
        }
        /* 画像の下に配置する価格ラベルのスタイル */
        .mobile-price-tag {
            display: block !important;
            background: #28a745 !important;
            color: #fff !important;
            font-weight: bold !important;
            font-size: 12px !important;
            text-align: center !important;
            padding: 2px 0 !important;
            margin-top: 3px !important;
            border-radius: 4px !important;
        }
        /* 商品名セルの改行を有効にする */
        .field-name, .field-product_name, td:nth-child(2) {
            line-height: 1.3 !important;
            white-space: pre-wrap !important;
        }
        /* 元の価格列はスマホで隠す（画像下に移動するため） */
        .field-price, .field-product_price {
            display: none !important;
        }
        /* タイマー設定 */
        td[class*="timer"], td[class*="time"], .field-timer_display {
            color: #ffcc00 !important;
            font-weight: bold !important;
            min-width: 85px !important;
            text-align: right !important;
        }
    }
</style>

<script>
    function updateLayout() {
        const rows = document.querySelectorAll('#result_list tbody tr');
        rows.forEach(row => {
            // 1. 商品名を「同人」でカットし、空白で改行する
            const nameCell = row.querySelector('.field-name, .field-product_name, td:nth-child(2)');
            if (nameCell) {
                let rawText = nameCell.innerText.split("同人")[0].trim();
                // スペース（全角・半角）をすべて改行に変換
                nameCell.innerHTML = rawText.replace(/[\s　]+/g, '<br>');
            }

            // 2. 価格を画像の下に移動する
            const priceCell = row.querySelector('.field-price, .field-product_price');
            const imageCell = row.querySelector('.field-image, .field-product_image');
            if (priceCell && imageCell && !imageCell.querySelector('.mobile-price-tag')) {
                const price = priceCell.innerText.trim();
                if (price) {
                    const tag = document.createElement('span');
                    tag.className = 'mobile-price-tag';
                    tag.innerText = price;
                    imageCell.appendChild(tag);
                }
            }
        });
    }

    document.addEventListener("DOMContentLoaded", updateLayout);
    window.addEventListener("load", updateLayout);
    setTimeout(updateLayout, 800);
</script>

<h1 id="site-name"><a href="{% url 'admin:index' %}">kawaii女の子図鑑</a></h1>
{% endblock %}
