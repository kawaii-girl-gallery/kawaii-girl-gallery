{% extends "admin/base_site.html" %} {% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>

<style>
    /* å…±é€šãƒ•ã‚©ãƒ³ãƒˆãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼è£…é£¾ */
    @import url('https://fonts.googleapis.com/css2?family=Rounded+Mplus+1c:wght@700;900&display=swap');
    body, #header, #content, h1 { font-family: 'Rounded Mplus 1c', sans-serif !important; }
    
    /* âœ¨ ãƒ˜ãƒƒãƒ€ãƒ¼è£…é£¾ */
    #header { 
        background: #1a1c23 !important; 
        padding: 15px 25px !important; 
        border-bottom: 4px solid transparent !important; 
        border-image: linear-gradient(to right, #ff4d94, #2684ff, #f0ad4e) 1 !important; 
    }
    #branding h1 { 
        font-size: 28px !important; 
        font-weight: 900 !important; 
        display: flex !important; 
        align-items: center !important; 
        gap: 12px !important; 
        background: linear-gradient(to right, #ff69b4, #2684ff, #f0ad4e) !important; 
        -webkit-background-clip: text !important; 
        -webkit-text-fill-color: transparent !important; 
    }
    #branding h1::before { content: 'ğŸ’•'; -webkit-text-fill-color: initial !important; font-size: 26px; }

    /* ğŸ’¡ å¼·åˆ¶ã‚«ãƒ©ãƒ¼é©ç”¨è¨­å®šï¼šã“ã® class ãŒä»˜ã„ã¦ã„ã‚‹æ™‚ã«ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã‚’ç¶­æŒ */
    .admin-custom-mode .period-title { 
        background: #f0ad4e !important; 
        color: #fff !important; 
        padding: 10px 20px; 
        border-radius: 8px; 
        display: inline-block;
    }

    /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .dashboard-header { margin-bottom: 30px; padding: 20px; background: #1a1a1a; border-radius: 12px; border: 1px solid #333; }
    .period-title { font-size: 28px; color: #00ffcc; margin: 0; font-weight: bold; }
    .date-form { display: flex; align-items: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    .custom-date-picker { background: #333 !important; border: 1px solid #444 !important; color: #fff !important; padding: 8px 12px; border-radius: 4px; cursor: pointer; width: 140px; }
    .submit-btn { background: #ff4d88; color: white; border: none; padding: 9px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .submit-btn:hover { background: #ff70a1; transform: scale(1.05); }

    /* âœ¨ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒªã‚¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .reset-area { 
        margin-top: 20px; padding: 15px; 
        background: rgba(255, 68, 68, 0.05); 
        border: 1px dashed #ff4444; 
        border-radius: 10px; 
        display: flex; align-items: center; justify-content: space-between;
    }
    .reset-btn { 
        background: #ff4444; color: #fff; border: none; padding: 8px 20px; 
        border-radius: 20px; font-weight: 900; cursor: pointer; transition: 0.3s;
    }
    .reset-btn:hover { background: #ff6666; box-shadow: 0 0 15px rgba(255, 68, 68, 0.4); }
    
    /* çµ±è¨ˆã‚°ãƒªãƒƒãƒ‰ */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
    .stat-card { background: #1e1e1e; padding: 25px; border-radius: 12px; border: 2px solid #333; text-align: center; font-weight: 900; }
    .stat-label { color: #888; font-size: 14px; margin-bottom: 10px; }
    .stat-value { font-size: 32px; color: #fff; font-weight: bold; }
    .stat-unit { font-size: 16px; color: #888; margin-left: 4px; }

    /* ç†±é‡ã‚«ãƒ¼ãƒ‰ï¼ˆç‰¹åˆ¥è‰²ï¼‰ */
    .heat-card { border-color: #ff4d88; background: linear-gradient(145deg, #1e1e1e, #251a1f); }
</style>

<div id="content-main" class="{{ cl_class }}">
    <div class="dashboard-header">
        <h1 class="period-title">ğŸ“Š é›†è¨ˆæœŸé–“ï¼š{{ period_title }}</h1>
        
        <form method="get" class="date-form">
            <span style="color: #888;">æœŸé–“å¤‰æ›´:</span>
            <input type="text" name="start_date" id="start_date" class="custom-date-picker" value="{{ start_date }}">
            <span style="color: #888;">ã€œ</span>
            <input type="text" name="end_date" id="end_date" class="custom-date-picker" value="{{ end_date }}">
            <button type="submit" class="submit-btn">é›†è¨ˆã‚’æ›´æ–°</button>
            <a href="." style="color: #888; font-size: 11px; text-decoration: underline; margin-left: 10px;">ä»Šæœˆã«æˆ»ã™</a>
        </form>

        {% if is_admin %}
        <div class="reset-area">
            <span style="color: #ff4444; font-size: 12px; font-weight: 800;">
                âš ï¸ æ³¨æ„ï¼šå®Ÿè¡Œã™ã‚‹ã¨å…¨ã¦ã®å£²ä¸Šå±¥æ­´ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™
            </span>
            <form method="post" onsubmit="return confirm('ğŸš€ æœ¬å½“ã«å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚');">
                {% csrf_token %}
                <input type="hidden" name="reset_sales" value="true">
                <button type="submit" class="reset-btn">ğŸ—‘ï¸ å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’å…¨ãƒªã‚»ãƒƒãƒˆ</button>
            </form>
        </div>
        {% endif %}
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">å£²ä¸Šåˆè¨ˆ</div>
            <div class="stat-value price-tag" style="color: #00ffcc;">Â¥{{ stats.total_revenue }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">è²©å£²ç‚¹æ•°</div>
            <div class="stat-value">{{ stats.total_items }}<span class="stat-unit">ä»¶</span></div>
        </div>

        <div class="stat-card">
            <div class="stat-label">è³¼å…¥è€…æ•°</div>
            <div class="stat-value">{{ stats.total_customers }}<span class="stat-unit">äºº</span></div>
        </div>

        <div class="stat-card heat-card">
            <div class="stat-label" style="color: #ffb3cc;">å¹³å‡è³¼å…¥ç‚¹æ•°ï¼ˆç†±é‡ï¼‰</div>
            <div class="stat-value" style="color: #ff4d88;">{{ stats.avg_items }}<span class="stat-unit" style="color: #ffb3cc;">ä»¶/äºº</span></div>
        </div>
    </div>
</div>

<script>
    flatpickr("#start_date", { locale: "ja", dateFormat: "Y-m-d", allowInput: true });
    flatpickr("#end_date", { locale: "ja", dateFormat: "Y-m-d", allowInput: true });

    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".price-tag").forEach(el => {
            let text = el.innerText.replace("Â¥", "").replace(/,/g, "").trim();
            let num = parseInt(text);
            if(!isNaN(num)) {
                el.innerText = "Â¥" + num.toLocaleString();
            }
        });
    });
</script>
{% endblock %}